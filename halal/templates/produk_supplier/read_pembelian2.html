{% extends "base/base.html" %}
{% load customfilter %}
{% block content %}
<div class="row">
    <div class="col-lg-12 grid-margin stretch-card">
        <div class="card">
            <div class="card-body">
                 <div class="d-flex justify-content-between align-items-center mb-3">
                    <h4 class="card-title">Data Pembelian</h4>
                </div>
                
               {% if not bahanbakuobj %}
                <a href="{% url 'create_bahanbaku' %}">
                    <button class="btn btn-inverse-success btn-sm mb-3">Create Bahan Baku First</button>
                </a>
                    
                {% else %}
                
                <a href="{% url 'create_pembelian' %}">
                    <button class="btn btn-inverse-success btn-sm mb-3">Create</button>
                </a>
                {% endif %}
                <div class="table-responsive mt-4">
                    <table class="table table-bordered" id="tabel">
                        <thead class="table-success">
                            <tr>
                                <th class="text-center">No</th>
                                <th class="text-center">Supplier</th>
                                <th class="text-center">Tanggal Pembelian</th>
                                <th class="text-center">Tanggal Pelunasan</th>
                                <th class="text-center">Tanggal Datang</th>
                                <th class="text-center">Bahan Baku</th>
                                <th class="text-center">Harga Beli</th>
                                <th class="text-center">Jumlah</th>
                                <th class="text-center">Grand Total</th>
                                <th class="text-center">Terbayarkan</th>
                                <th class="text-center">Status</th>
                                <th class="text-center">Action</th> 
                            </tr>
                        </thead>
    
                        <tbody>
                         {% for item in pembelianobj %}
                             {% with item_terbayar=item.0.terbayarkan item_total=item.3 %}
                            <tr class="{% if item_total > item_terbayar %}table-danger{% endif %}">
                                <td class="text-center">{{ forloop.counter }}</td>
                                <td class="text-center">{{ item.0.nama_supplier }}</td>
                                <td class="text-center">{{ item.0.tanggal_beli }}</td>
                                <td class="text-center">{{ item.0.tanggal_pelunasan }}</td>
                                <td class="text-center">{{ item.0.tanggal_datang }}</td>
                                <td class="text-center">
                                    {% for item2 in item.1 %}
                                    <ul>
                                        <li>
                                            {{ item2.id_bahanbaku.nama_bahanbaku  }} 
                                        </li>
                                    </ul>
                                    {% endfor %}
                                </td>

                                <td class="text-center">
                                    {% for item2 in item.1 %}
                                    <ul>
                                        <li>{{item2.harga_beli|separator_ribuan}}</li>
                                    </ul>
                                    {% endfor %}
                                </td>

                                   <td class="text-center">
                                    {% for item2 in item.1 %}
                                    <ul>
                                        <li>{{ item2.jumlah|separator_ribuan }}</li>
                                    </ul>
                                    {% endfor %}
                                </td>

                                <td class="text-center">
                                   <strong>{{item.2|separator_ribuan}}</strong> 
                                </td>
                                
                                <td class="text-center"><strong>{{ item.0.terbayarkan|separator_ribuan }}</strong></td>
                                
                                <td></td>
                                <!-- <td class="text-center align-center">
                                    <strong class="mr-4">{% if item_terbayar < item_total %} Open{% else %} Closed{% endif %}</strong>
                                    {% if item_terbayar < item_total %}
                                    <a href="{% url 'lunas_utang' id=item.0.id_pembelian keterangan='pembelian' %}?source=pembelian" class="btn btn-success">Lunas</a>
                                    {% endif %}
                                </td> -->
                                
                             
                                <td>
                                    {% for item2 in item.1 %}
                                    <ul>
                                        <li><a href="{% url 'update_pembelian' item2.id_detail_pembelian %}" ><Button class="btn btn-inverse-warning btn-sm btn-icon-text">Update</Button></a>
                                        </li>
                                        <li> <a href="{% url 'delete_pembelian' item2.id_detail_pembelian %}"><Button class="btn btn-inverse-danger btn-sm btn-icon-text">Delete</Button></a></li>
                                    </ul>
                                    {% endfor %}
                                </td>
                              
                              

                            </tr>
                            {% endwith %}
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
             </div>
       </div>
    </div>
</div>
{% endblock content %}